<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>è¿œç¨‹APIéªŒè¯åŠ å¯†å™¨</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
<style>
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;max-width:900px;margin:20px auto;padding:20px;background:#f0f2f5;color:#1f2937}
    .step{background:#fff;padding:25px;border-radius:12px;box-shadow:0 2px 5px rgba(0,0,0,0.05);margin-bottom:20px;border:1px solid #e5e7eb}
    h2{margin-top:0;font-size:18px;color:#111827;border-bottom:1px solid #eee;padding-bottom:10px;margin-bottom:15px}
    label{display:block;font-weight:600;font-size:14px;margin-bottom:5px;color:#4b5563}
    input, textarea, select{width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px;box-sizing:border-box;font-family:monospace;margin-bottom:15px;font-size:14px}
    input:focus, textarea:focus{border-color:#3b82f6;outline:none;box-shadow:0 0 0 2px rgba(59,130,246,0.1)}
    .highlight{background:#eff6ff;padding:15px;border-radius:6px;border:1px dashed #3b82f6;color:#1e40af;font-size:13px;line-height:1.6;margin-bottom:15px}
    button{background:#3b82f6;color:white;border:none;padding:12px 24px;border-radius:6px;font-weight:bold;cursor:pointer;font-size:15px;transition:0.2s}
    button:hover{background:#2563eb}
    code{background:#e0e7ff;color:#3730a3;padding:2px 4px;border-radius:4px;font-family:monospace}
</style>
</head>
<body>

<!-- ç¬¬ä¸€æ­¥ï¼šç”Ÿæˆæ ¸å¿ƒå¯†é’¥ -->
<div class="step">
    <h2>1. ç”ŸæˆçœŸæ­£çš„è§£å¯†å¯†é’¥</h2>
    <p class="highlight">
        è¿™æ˜¯ç³»ç»Ÿåˆšåˆšç”Ÿæˆçš„éšæœºå¯†é’¥ã€‚<b>è¯·åŠ¡å¿…å¤åˆ¶ä¿å­˜å¥½ï¼</b><br>
        ä½ éœ€è¦æŠŠè¿™ä¸ªå­—ç¬¦ä¸²æ”¾åˆ°ä½ çš„ API è¿”å›å€¼é‡Œã€‚å¦‚æœå¼„ä¸¢äº†ï¼ŒåŠ å¯†åçš„ç½‘é¡µå°†æ°¸è¿œæ— æ³•æ‰“å¼€ã€‚
    </p>
    <label>ç³»ç»Ÿç”Ÿæˆçš„è§£å¯†å¯†é’¥ (Real Key):</label>
    <div style="display:flex;gap:10px;margin-bottom:15px">
        <input type="text" id="realKey" readonly style="background:#f9fafb;color:#059669;font-weight:bold">
        <button onclick="genKey()" style="background:#10b981;white-space:nowrap">ğŸ”„ é‡æ–°ç”Ÿæˆ</button>
        <button onclick="copyKey()" style="background:#6b7280;white-space:nowrap">ğŸ“‹ å¤åˆ¶</button>
    </div>
</div>

<!-- ç¬¬äºŒæ­¥ï¼šé…ç½® API -->
<div class="step">
    <h2>2. é…ç½® API æ¥å£é€»è¾‘</h2>
    <label>API è¯·æ±‚åœ°å€æ¨¡æ¿ (ä½¿ç”¨ {KEY} ä»£è¡¨ç”¨æˆ·è¾“å…¥çš„å†…å®¹):</label>
    <input type="text" id="apiUrl" placeholder="https://api.example.com/check?token={KEY}" value="https://example.com/api/verify?code={KEY}">
    
    <label>API è¿”å›æ•°æ®ç±»å‹:</label>
    <select id="resType">
        <option value="json_prop">JSON å¯¹è±¡ (æ¨è)</option>
        <option value="text">çº¯æ–‡æœ¬ (Response Body ç›´æ¥æ˜¯å¯†é’¥)</option>
    </select>

    <div id="jsonPathBox">
        <label>JSON å­—æ®µè·¯å¾„ (å¯†é’¥åœ¨è¿”å›JSONçš„å“ªä¸ªå­—æ®µé‡Œ?):</label>
        <input type="text" id="jsonPath" placeholder="data.secret_key" value="data.key">
        <p style="font-size:12px;color:#666">ä¾‹å¦‚ API è¿”å› <code>{"status":200, "data": {"key": "abc"}}</code>ï¼Œåˆ™å¡« <code>data.key</code></p>
    </div>
</div>

<!-- ç¬¬ä¸‰æ­¥ï¼šåŠ å¯† -->
<div class="step">
    <h2>3. ç²˜è´´æºä»£ç å¹¶ç”Ÿæˆ</h2>
    <textarea id="sourceHtml" placeholder="åœ¨æ­¤ç²˜è´´åŸæ¥çš„ HTML ä»£ç ..." style="height:150px"></textarea>
    <button onclick="doEncrypt()" style="width:100%">ğŸ”’ ç”Ÿæˆç¦»çº¿æ–‡ä»¶</button>
</div>

<!-- ç»“æœ -->
<div class="step" id="resArea" style="display:none">
    <h2>4. ç”Ÿæˆç»“æœ</h2>
    <textarea id="finalHtml" readonly style="height:200px"></textarea>
    <p>å°†ä¸Šæ–¹ä»£ç ä¿å­˜ä¸º <code>index.html</code> å‘å¸ƒå³å¯ã€‚</p>
</div>

<script>
    function genKey() {
        document.getElementById('realKey').value = CryptoJS.lib.WordArray.random(32).toString();
    }
    
    function copyKey() {
        navigator.clipboard.writeText(document.getElementById('realKey').value);
        alert('å¯†é’¥å·²å¤åˆ¶ï¼è¯·ç¡®ä¿ä½ æŠŠå®ƒé…ç½®åˆ°äº†ä½ çš„APIä¸­ã€‚');
    }

    document.getElementById('resType').addEventListener('change', function(){
        document.getElementById('jsonPathBox').style.display = this.value === 'json_prop' ? 'block' : 'none';
    });

    function doEncrypt() {
        const realKey = document.getElementById('realKey').value;
        const source = document.getElementById('sourceHtml').value;
        const urlTemplate = document.getElementById('apiUrl').value;
        const resType = document.getElementById('resType').value;
        const jsonPath = document.getElementById('jsonPath').value;

        if(!realKey || !source || !urlTemplate) return alert('è¯·å¡«å†™å®Œæ•´ä¿¡æ¯');

        // ä½¿ç”¨ RealKey åŠ å¯†æºç 
        const encrypted = CryptoJS.AES.encrypt(source, realKey).toString();

        // æ„å»ºæœ€ç»ˆ HTML
        const html = `<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Restricted Access</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"><\/script>
<style>
body{background:#111;color:#eee;font-family:monospace;display:flex;justify-content:center;align-items:center;height:100vh;margin:0}
.c{text-align:center;width:300px}
input{background:#222;border:1px solid #444;color:#fff;padding:12px;width:100%;border-radius:4px;margin-bottom:10px;text-align:center;font-size:16px;outline:none}
input:focus{border-color:#0ea5e9}
button{background:#0ea5e9;color:#fff;border:none;padding:12px;width:100%;border-radius:4px;cursor:pointer;font-weight:bold}
button:disabled{background:#444;cursor:wait}
.loading{display:none;margin-top:10px;color:#888;font-size:12px}
.err{color:#f43f5e;font-size:12px;margin-top:10px;display:none}
</style>
</head>
<body>
<div class="c" id="login">
    <h3 style="margin-bottom:20px">ğŸ” èº«ä»½éªŒè¯</h3>
    <input type="text" id="k" placeholder="è¾“å…¥ API æˆæƒç  / Token" onkeyup="if(event.key==='Enter')verify()">
    <button id="b" onclick="verify()">éªŒè¯å¹¶è·å–æƒé™</button>
    <div class="loading" id="l">æ­£åœ¨è¿æ¥é‰´æƒæœåŠ¡å™¨...</div>
    <div class="err" id="e"></div>
</div>
<script>
const D = "${encrypted}"; // åŠ å¯†åçš„æ•°æ®
const T = "${urlTemplate}"; // API æ¨¡æ¿

async function verify() {
    const k = document.getElementById('k').value.trim();
    if(!k) return;
    
    const ui = {
        b: document.getElementById('b'),
        l: document.getElementById('l'),
        e: document.getElementById('e')
    };
    
    ui.b.disabled = true;
    ui.l.style.display = 'block';
    ui.e.style.display = 'none';

    try {
        // 1. æ›¿æ¢æ¨¡æ¿ä¸­çš„ {KEY}
        const api = T.replace('{KEY}', encodeURIComponent(k));
        
        // 2. è¯·æ±‚ API
        const res = await fetch(api);
        if(!res.ok) throw new Error('API æ‹’ç»è®¿é—® (403/404)');
        
        let realKey = '';
        
        // 3. è§£æå¯†é’¥
        ${resType === 'json_prop' 
          ? `const json = await res.json();
             // ç®€å•çš„è·¯å¾„è§£æ (å¦‚ data.key)
             realKey = "${jsonPath}".split('.').reduce((o,i)=>o?o[i]:null, json);` 
          : `realKey = await res.text();`}
        
        if(!realKey) throw new Error('é‰´æƒé€šè¿‡ï¼Œä½†æœªè¿”å›æœ‰æ•ˆå¯†é’¥');

        realKey = realKey.trim();

        // 4. å°è¯•è§£å¯†
        const bytes = CryptoJS.AES.decrypt(D, realKey);
        const original = bytes.toString(CryptoJS.enc.Utf8);
        
        if(!original) throw new Error('å¯†é’¥é”™è¯¯ (è§£å¯†å¤±è´¥)');

        // 5. å†™å…¥é¡µé¢
        document.open();
        document.write(original);
        document.close();

    } catch (err) {
        console.error(err);
        ui.e.innerText = "éªŒè¯å¤±è´¥: " + err.message;
        ui.e.style.display = 'block';
        ui.b.disabled = false;
        ui.l.style.display = 'none';
        // åŠ¨ç”»éœ‡åŠ¨
        const box = document.getElementById('login');
        box.style.transform = 'translateX(5px)';
        setTimeout(()=>box.style.transform='translateX(0)', 100);
        setTimeout(()=>box.style.transform='translateX(-5px)', 200);
        setTimeout(()=>box.style.transform='translateX(0)', 300);
    }
}
<\/script>
</body>
</html>`;

        document.getElementById('finalHtml').value = html;
        document.getElementById('resArea').style.display = 'block';
    }
    
    // åˆå§‹åŒ–ç”Ÿæˆä¸€ä¸ªKey
    genKey();
</script>
</body>
</html>