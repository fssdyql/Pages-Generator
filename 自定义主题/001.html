<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å—ä¿æŠ¤çš„å†…å®¹</title>
<style>
    body { font-family: -apple-system,"Segoe UI",Roboto,sans-serif; background: #f8fafc; color: #334155; display: flex; align-items: center; justify-content: center; min-height: 100vh; margin: 0; padding: 20px; box-sizing: border-box; }
    
    /* å¡ç‰‡å®¹å™¨ï¼šå¤åˆ» .box æ ·å¼ï¼Œä½†è°ƒæ•´ä¸ºé€‚åˆç™»å½•çš„å®½åº¦ */
    .box { width: 100%; max-width: 420px; background: #fff; border-radius: 16px; box-shadow: 0 10px 15px -3px rgba(0,0,0,0.05); overflow: hidden; border: 1px solid #e2e8f0; }
    
    /* å¤´éƒ¨ï¼šå¤åˆ» .h æ ·å¼ */
    .h { padding: 20px 24px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: #fff; }
    .h h1 { font-size: 18px; margin: 0; color: #0f172a; display: flex; align-items: center; gap: 8px; }
    
    /* æ ‡ç­¾é¡µï¼šå¤åˆ» .tabs å’Œ .tab æ ·å¼ */
    .tabs { background: #f1f5f9; display: flex; gap: 4px; padding: 10px 20px 0; border-bottom: 1px solid #e2e8f0; }
    .tab { padding: 10px 20px; cursor: pointer; font-weight: 600; color: #64748b; border-radius: 8px 8px 0 0; font-size: 14px; transition: 0.2s; user-select: none; }
    .tab:hover { background: #e2e8f0; color: #334155; }
    .tab.active { background: #fff; color: #2563eb; box-shadow: 0 -4px 6px -1px rgba(0,0,0,0.02); margin-bottom: -1px; border-bottom: 1px solid #fff; }
    
    /* å†…å®¹åŒºåŸŸ */
    .content-area { padding: 24px; background: #fff; min-height: 200px; display: flex; flex-direction: column; justify-content: center; }
    
    /* è¾“å…¥æ¡†ç»„ï¼šå¤åˆ» .key-in é£æ ¼ */
    .form-group { margin-bottom: 16px; }
    .label { font-size: 12px; font-weight: 600; color: #64748b; margin-bottom: 6px; display: block; }
    .input-box { width: 100%; border: 1px solid #cbd5e1; padding: 10px 12px; border-radius: 8px; font-size: 14px; outline: none; box-sizing: border-box; transition: 0.2s; color: #334155; }
    .input-box:focus { border-color: #2563eb; box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1); }
    
    /* æŒ‰é’®ï¼šå¤åˆ» .btn å’Œ .btn-dl */
    .btn { display: inline-flex; align-items: center; justify-content: center; padding: 10px 16px; border-radius: 8px; border: none; font-size: 14px; cursor: pointer; font-weight: 600; transition: 0.2s; width: 100%; box-sizing: border-box; }
    .btn-primary { background: #2563eb; color: #fff; }
    .btn-primary:hover { filter: brightness(0.95); }
    .btn-primary:active { transform: translateY(1px); }
    .btn-primary:disabled { background: #94a3b8; cursor: not-allowed; }

    /* æ¬¡è¦æŒ‰é’®ï¼šå¤åˆ» .btn-lnk */
    .btn-sec { background: #fff; border: 1px solid #cbd5e1; color: #475569; margin-top: 10px; }
    .btn-sec:hover { border-color: #2563eb; color: #2563eb; }

    /* æ¶ˆæ¯æç¤ºåŒº */
    .msg-box { margin-top: 16px; padding: 10px; border-radius: 6px; font-size: 13px; text-align: center; display: none; }
    .msg-error { background: #fef2f2; color: #ef4444; border: 1px solid #fee2e2; }
    .msg-success { background: #f0fdf4; color: #16a34a; border: 1px solid #dcfce7; }
    .msg-info { background: #eff6ff; color: #2563eb; border: 1px solid #dbeafe; }

    .hidden { display: none !important; }
</style>
</head>
<body>

<div class="box">
    <!-- å¤´éƒ¨ -->
    <div class="h">
        <h1>ğŸ”’ å—é™è®¿é—®</h1>
        <span style="font-size:12px;color:#94a3b8;font-family:monospace">ENCRYPTED</span>
    </div>

    <!-- æ ‡ç­¾é¡µåˆ‡æ¢ -->
    <div class="tabs">
        <div class="tab active" id="tab-api" onclick="switchMode('api')">API éªŒè¯</div>
        <div class="tab" id="tab-local" onclick="switchMode('local')">æœ¬åœ°è§£é”</div>
    </div>

    <!-- é¢æ¿å®¹å™¨ -->
    <div class="content-area">
        
        <!-- 1. API éªŒè¯é¢æ¿ -->
        <div id="panel-api">
            <div class="form-group">
                <label class="label">è®¿é—®ä»¤ç‰Œ (Access Token)</label>
                <input type="text" class="input-box" id="inp-token" placeholder="è¯·è¾“å…¥æ‚¨çš„ Key æˆ– Token..." onkeyup="if(event.key==='Enter') doApi()">
            </div>
            <button class="btn btn-primary" id="btn-api" onclick="doApi()">ğŸš€ éªŒè¯èº«ä»½</button>
        </div>

        <!-- 2. æœ¬åœ°è§£é”é¢æ¿ -->
        <div id="panel-local" class="hidden">
            <div class="form-group">
                <label class="label">è®¿é—®å¯†ç  (Password)</label>
                <input type="password" class="input-box" id="inp-pass" placeholder="è¾“å…¥å¯†ç ..." onkeyup="if(event.key==='Enter') doLocal()">
            </div>
            <button class="btn btn-primary" onclick="doLocal()">ğŸ”“ ç«‹å³è§£é”</button>
            
            <div style="height:1px;background:#f1f5f9;margin:16px 0;"></div>
            
            <label class="label" style="text-align:center;margin-bottom:8px">æˆ–ä½¿ç”¨å¯†é’¥æ–‡ä»¶</label>
            <input type="file" id="file-picker" style="display:none" onchange="doFile(this)">
            <button class="btn btn-sec" onclick="document.getElementById('file-picker').click()">
                ğŸ“‚ é€‰æ‹© Key æ–‡ä»¶
            </button>
        </div>

        <!-- æ¶ˆæ¯åé¦ˆåŒºåŸŸ -->
        <div id="msg" class="msg-box"></div>
    </div>
</div>

<script>
    // --- é€»è¾‘å¯¹æ¥éƒ¨åˆ† ---

    // 1. åˆå§‹åŒ–ï¼šæ ¹æ®é…ç½®éšè— API Tab
    if (!window.LX.config.useApi) {
        document.getElementById('tab-api').style.display = 'none';
        switchMode('local');
    }

    // 2. æ¨¡å¼åˆ‡æ¢é€»è¾‘
    function switchMode(mode) {
        // æ›´æ–° Tab æ ·å¼
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.getElementById('tab-' + mode).classList.add('active');
        
        // åˆ‡æ¢é¢æ¿æ˜¾ç¤º
        document.getElementById('panel-api').classList.toggle('hidden', mode !== 'api');
        document.getElementById('panel-local').classList.toggle('hidden', mode !== 'local');
        
        // æ¸…ç©ºæ¶ˆæ¯
        showMsg('');
    }

    // 3. æ¶ˆæ¯æ˜¾ç¤ºé€»è¾‘ (å¯¹æ¥å†…æ ¸å›è°ƒ)
    window.LX.onMessage = function(text, type) {
        const btn = document.getElementById('btn-api');
        
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        if(btn) {
            btn.disabled = false;
            btn.innerHTML = 'ğŸš€ éªŒè¯èº«ä»½';
        }

        if (type === 'process') {
            if(btn) {
                btn.disabled = true;
                btn.innerHTML = 'ğŸ”„ å¤„ç†ä¸­...';
            }
            showMsg(text, 'info');
        } else if (type === 'error') {
            showMsg(text, 'error');
            shake(); // é”™è¯¯æ—¶éœ‡åŠ¨ä¸€ä¸‹
        } else {
            showMsg(text, 'success');
        }
    };

    function showMsg(text, type) {
        const el = document.getElementById('msg');
        if (!text) {
            el.style.display = 'none';
            return;
        }
        el.style.display = 'block';
        el.className = 'msg-box msg-' + type;
        el.innerText = text;
    }

    // 4. è§¦å‘åŠ¨ä½œ
    function doApi() {
        const val = document.getElementById('inp-token').value.trim();
        window.LX.unlockWithApi(val);
    }

    function doLocal() {
        const val = document.getElementById('inp-pass').value;
        window.LX.unlock(val);
    }

    function doFile(input) {
        if(input.files && input.files[0]) {
            showMsg('æ­£åœ¨è¯»å–æ–‡ä»¶...', 'info');
            window.LX.unlockWithFile(input.files[0]);
        }
    }

    // ç®€å•çš„é”™è¯¯éœ‡åŠ¨åŠ¨ç”»
    function shake() {
        const box = document.querySelector('.box');
        box.style.transform = 'translateX(5px)';
        setTimeout(() => box.style.transform = 'translateX(-5px)', 50);
        setTimeout(() => box.style.transform = 'translateX(5px)', 100);
        setTimeout(() => box.style.transform = 'translateX(0)', 150);
    }
</script>
</body>
</html>